<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>Visualizing 500 Days of Summer</title>
		<script type="text/javascript" src="./js/d3.v3.js"></script>		
		<style>
/** Add CSS rules here */
#main-c {
width: 900px;
margin: 0 auto;
}

#info-c {
position:absolute;
width: 900px;
//background: rgba(10,10,10,0.1);
padding: 50px 30px 0;
}

#info-c > div {
text-align: center;
}

#day {
font-size: 5em;
font-family: Helvetica;
color: rgb(200,200,200);
-webkit-transition: opacity 1s;
-moz-transition: opacity 1s;
-o-transition: opacity 1s;
transition: opacity 1s;
}

#day > span {
-webkit-transition: 0.5s;
-moz-transition: 0.5s;
-o-transition: 0.5s;
transition: 0.5s;
}

#place {
font-size: 1em;
font-weight: bold;
font-family: Helvetica, Arial ,sans-serif;
}

#quote {
padding: 0.5em 0;
}

#quote pre {

	font-size: 1.5em;
	font-style: italic;
	font-family: Georgia;
	display:inline-block;
	background: rgba(200,200,220,0.4);
	color: #eee;
	padding: 0.5em;
}

		</style>
	</head>
	<body>
	<div id="main-c">
		<div id="info-c">
			<div id="day">400</div>
			<div id="place">(At the park)</div>
			<div id="quote"><pre>
♡“Hi, Tom!”
“Hey. Summer. I must have walked right by you.”
“Yeah.”</pre></div>
		</div>
		<center id="svg-c"></center>
	</div>
		<script type="text/javascript">

		//Color Pallete
		// var love_colors = ["#83AF9B", "#C8C8A9", "#FE4365"];	//http://www.colourlovers.com/palette/629637/(%E2%97%95%E3%80%9D%E2%97%95)
		// var love_colors = ["#028F76", "#FFEAAD", "#D14334"];		//http://www.colourlovers.com/palette/1283145/The_Way_You_Love_Me
		// var love_colors = ["#7E5686", "#A5AAD9", "#BA3C3D"];		//http://www.colourlovers.com/palette/2641140/Burning_Love
		var love_colors = ["#7E5686", "#A5AAD9", "#FE4365"];		//http://www.colourlovers.com/palette/2641140/Burning_Love

			//d3.csv("./data/Pi-150-v2.csv", function(data) { console.log(data); });
			var w=700;
			var h=700;

			//Var for plotting
				var delta = 20;
				var xScale = w/(500+delta*2);				
				var rScale=2;	//Scale for day-circles

				var aDelay=1200;	//Delay per day

			var svg=d3.select("#svg-c")
						.append("svg")
						.attr("width",w)
						.attr("height",h);

			var myData;
			d3.csv("./data/500-days-data-v2.csv", function(error,data)
			{
			  if (error) {  
			  	//If error is not null, something went wrong.
      		console.log(error);  //Log the error.
        } else {      
          //If no error, the file loaded correctly. Yay!
          console.log("Dataset loaded!");
	        // console.log(data[0].Scene+ " "+data[10].Day);   //Log the data.
				 	// console.log(data); 
				 	// return data; 
				 	myData = data.map(function(d) { return [ +d["Scene"], d["Day"] ]; });
				 	// console.log(myData);   //Log the data.
				 	generateViz(data);				 	
		 		}
			 });



			function xPos(day) {

				if(day!="x")
				{
				// console.log(day*1+5);
				// dummy=d*1;
				return(delta+day*xScale);
				}
				else return 0;			
			}



			function generateViz(data) {				
				//////////////////////////////////////////////////////
				///*
				// Draw Arcs
///*
				var lastDay = -30;				

				var arcs = svg.selectAll("path")
											.data(data)
											.enter()
											.append("path")
											.attr({
												d: function(d,i) {													
													var nextX = xPos(d.Day);
													if(nextX>0)
													{
														var prevX = xPos(lastDay);
														var r = Math.abs((nextX-prevX)/2);
														lastDay = d.Day;
														// console.log("M "+prevX+" "+(h/2)+" A "+r+" "+r+" 0 0 1 "+nextX+" "+(h/2));
														return "M "+prevX+" "+(h/2)+" A "+r+" "+(r)+" 0 0 1 "+nextX+" "+(h/2);			
													} else return "M 0 0";
												},
												'fill': 'none',
												'opacity': 0.4,
												'stroke': "rgb(230,230,255)", //250
												'stroke-width': "2",
												//'stroke-dasharray': "10, 3000"
											})
											.transition()
											.duration(aDelay*2)
											.ease("linear")
											.delay(function(d,i) {return i*aDelay;})
											.attr({	
												'stroke': "rgb(20,30,80)",
												'stroke-dasharray': "3000, 10"
											})
											.transition()
											.duration(aDelay)
											.ease("linear")
											.delay(function(d,i) {return (i+1)*aDelay;})
											.attr({	
												'stroke': "rgb(180,180,250)",
											});
//*/
				//////////////////////////////////////////////////////
				///*
				// Draw Circles

				var circles = svg.selectAll("circles")
													.data(data)
													.enter()
													.append("circle")
													.attr({
														cx: function(d, i) {
															if(d.Day!="x")
															{
															// console.log(d.Day*1+5);
															return(delta+d.Day*xScale);
															}
															else return 0;
														},
														cy: h/2,
														r: function(d) {
															if(d.Day!="x")
															{
																return d.Scene*rScale/250+5;
															} 
															else return 0;
														},	
														fill: "rgb(200,200,200)",
														opacity: 0.3
													})
													.on("mouseover", function() {
													        d3.select(this)
													          .attr("fill", "orange");
													})
													.transition()
													.duration(aDelay)
													.ease("linear")
													.delay(function(d,i) {return (i+1)*aDelay-100;})
													.attr({
														r: function(d,i) {
															if(d.Day!="x")
															{
																setTimeout(function () {showText(d.Together*1, d.Day);},(i+1)*aDelay-100);
																
																return d.Scene*rScale/250+7;																
															} 
															else return 0;
														},
														fill: function(d) {															
															// console.log(love_colors[d.Together*1+1]);
															return love_colors[d.Together*1+1];
														},
														opacity: 0.7
													});

				
				//*/
				////////////////////////////////////////////////////////
				/*
				//Add Labels

				var labels = svg.selectAll("text")
											   .data(data)
											   .enter()
											   .append("text");
				
				labels.text(function(d){
					return d.Day;
				})
				.attr("x", function(d) {			    
						if(d.Day!="x")
						{
						console.log(d.Day*1+5);
						// dummy=d*1;
						return(delta+d.Day*xScale);
						}
						else return 0;
			  })
			  .attr("y", h/2+20)
			  .attr("font-family", "sans-serif")
		   	.attr("font-size", "11px")
		   	.attr("fill", "blue")
		   	.attr("text-anchor", "middle");
				//*/
			
			} //End generateViz()

			function showText(t_status, t_day, t_desc, t_quote) {

			}

			function showText(t_status, t_day) {
				var day_c = document.getElementById('day');
				var place_c = document.getElementById('place');
				var quote_c = document.getElementById('place');
				place_c.style.display = 'none';
				quote_c.style.display = 'none';

				day_c.style.opacity = 1;
				if(t_status == 1) {
					day_c.innerHTML = "<span style='color:"+love_colors[2]+"'> ♥"+t_day+"</span>";
				}
				else if(t_status == -1) {
					day_c.innerHTML = "<span style='color:"+love_colors[0]+"'> ♡"+t_day+"</span>";
				} else {
					day_c.innerHTML = "<span style='color:"+love_colors[1]+"'> ♡"+t_day+"</span>";
				}

				setTimeout(function() { document.getElementById('day').style.opacity = 0.5;}, 500);
			}

		</script>
	</body>
</html>